version: "3.9"
services:
  agent:
    user: "$UID"
    build: .
    image: carloscdias/data_gathering:latest
    container_name: data_gathering-container
    cap_add:
      - NET_ADMIN
    environment:
      - DISPLAY=:2
      - QUEUE=$QUEUE
      - BACKEND=$BACKEND
      - BROKER=$BROKER
    volumes:
      - data_gathering_volume:/data
  wptagent:
    image: carloscdias/wptagent
    container_name: wpt_agent-container
    environment:
      - WPT_SERVER=$WPT_SERVER
      - LOCATION=$LOCATION
      - WPT_KEY=$WPT_KEY
      - NAME=$NAME
      - SHAPER=$SHAPER
      - EXTRA_ARGS=$EXTRA_ARGS
    command: python3 wptagent.py -vvvv --xvfb --dockerized --server "${WPT_SERVER}work/" --location $LOCATION --key $WPT_KEY
  watchtower:
    image: containrrr/watchtower
    container_name: watchtower
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    command: data_gathering-container wpt_agent-container
volumes:
  data_gathering_volume:  

